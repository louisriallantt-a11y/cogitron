<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cogitron Kids ðŸš€</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --primary: #FF6B6B;
            --secondary: #4ECDC4;
            --bg: #F7FFF7;
            --text: #2D3436;
        }
        body {
            font-family: 'Quicksand', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            margin: 0;
        }
        .kids-card {
            background: white;
            padding: 30px;
            border-radius: 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            max-width: 450px;
            width: 100%;
            text-align: center;
            border: 5px solid var(--secondary);
        }
        h1 { color: var(--primary); font-size: 2.5rem; margin-bottom: 10px; }
        input, select {
            width: 85%;
            padding: 15px;
            margin: 10px 0;
            border-radius: 20px;
            border: 3px solid #eee;
            font-size: 16px;
            outline: none;
        }
        input:focus { border-color: var(--secondary); }
        button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 15px 35px;
            border-radius: 50px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px 5px;
        }
        button:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(255,107,107,0.4); }
        #chat-section { display: none; width: 100%; max-width: 700px; }
        #chat-box {
            height: 400px;
            overflow-y: auto;
            border: 2px solid #eee;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            background: #fff;
            text-align: left;
        }
        .bot-msg { background: #E0F2F1; padding: 15px; border-radius: 20px 20px 20px 0; margin: 10px 0; border-left: 5px solid var(--secondary); }
        .user-msg { background: #FFF9C4; padding: 15px; border-radius: 20px 20px 0 20px; margin: 10px 0; text-align: right; border-right: 5px solid var(--primary); }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
</head>
<body>

    <div id="auth-section" class="kids-card">
        <h1>Coucou ! ðŸ‘‹</h1>
        <p>Demande Ã  tes parents de t'aider Ã  te connecter Ã  <b>Cogitron</b>.</p>
        
        <input type="email" id="email" placeholder="Email des parents">
        <input type="password" id="password" placeholder="Mot de passe secret">
        
        <div style="margin: 15px 0;">
            <label style="font-weight: bold;">Quel Ã¢ge as-tu ?</label><br>
            <select id="user-age">
                <option value="6">6 ans</option>
                <option value="8" selected>8 ans</option>
                <option value="10">10 ans</option>
                <option value="12">12 ans</option>
                <option value="14">14 ans</option>
            </select>
        </div>

        <button onclick="handleAuth('signUp')">CrÃ©er mon compte</button>
        <button onclick="handleAuth('signIn')" style="background: var(--secondary)">Me connecter</button>
    </div>

    <div id="chat-section">
        <div class="kids-card" style="max-width: 100%;">
            <h2 style="color: var(--secondary)">Robot Cogitron ðŸ¤–</h2>
            <div id="chat-box"></div>
            <div style="display: flex;">
                <input type="text" id="user-input" placeholder="Dis-moi quelque chose..." style="flex: 1;">
                <button onclick="askAI()">ðŸš€</button>
            </div>
            <button onclick="signOut()" style="background:#b2bec3; font-size: 14px; padding: 10px 20px;">Quitter</button>
        </div>
    </div>

    <script>
        // --- 1. CONFIGURATION ---
        const SB_URL = "https://mrzevhvpoltsobxtkpxe.supabase.co";
        const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1yemV2aHZwb2x0c29ieHRrcHhlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA5MTY2MDksImV4cCI6MjA4NjQ5MjYwOX0.4NOt_j0aP02Nh-E_7mJy32hE8Q0ag0gA32PXgxNpSvU";
        const GROQ_KEY = "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"; // Remets ta clÃ© gsk_... ici

        // Initialisation du client Supabase (nommÃ© clientSB pour Ã©viter les bugs)
        const clientSB = supabase.createClient(SB_URL, SB_KEY);
        let currentAge = 8;

        // --- 2. GESTION AUTHENTIFICATION ---
        async function handleAuth(type) {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            currentAge = document.getElementById('user-age').value;

            if (!email || !password) {
                alert("N'oublie pas de remplir l'email et le mot de passe !");
                return;
            }

            const { data, error } = await clientSB.auth[type]({
                email: email,
                password: password,
                options: {
                    data: { age: currentAge }
                }
            });

            if (error) {
                alert("Erreur : " + error.message);
            } else {
                if (type === 'signUp') {
                    alert("Compte crÃ©Ã© ! Tu peux maintenant te connecter.");
                } else {
                    showChat();
                }
            }
        }

        function showChat() {
            document.getElementById('auth-section').style.display = 'none';
            document.getElementById('chat-section').style.display = 'block';
            addMessage("Cogitron", "Salut ! Je suis ton ami robot. Pose-moi n'importe quelle question !", "bot-msg");
        }

        async function signOut() {
            await clientSB.auth.signOut();
            location.reload();
        }

        // --- 3. LOGIQUE IA ---
        async function askAI() {
            const inputField = document.getElementById('user-input');
            const message = inputField.value.trim();
            if (!message) return;

            addMessage("Toi", message, "user-msg");
            inputField.value = "";

            try {
                const response = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${GROQ_KEY}`,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        "model": "llama-3.3-70b-versatile",
                        "messages": [
                            { 
                                "role": "system", 
                                "content": `Tu es Cogitron, un robot Ã©ducatif et trÃ¨s gentil pour un enfant de ${currentAge} ans. Tu dois expliquer les choses simplement, utiliser des emojis, et ne jamais Ãªtre mÃ©chant ou parler de choses pour adultes.` 
                            },
                            { "role": "user", "content": message }
                        ]
                    })
                });

                const data = await response.json();
                
                if (data.error) {
                    addMessage("Erreur", "Oups, mon cerveau de robot est fatiguÃ©. VÃ©rifie ma clÃ© API !", "bot-msg");
                } else {
                    const aiReply = data.choices[0].message.content;
                    addMessage("Cogitron", aiReply, "bot-msg");
                }
            } catch (err) {
                addMessage("Erreur", "Je n'arrive pas Ã  me connecter Ã  internet...", "bot-msg");
            }
        }

        function addMessage(author, text, className) {
            const chatBox = document.getElementById('chat-box');
            const msgDiv = document.createElement('div');
            msgDiv.className = className;
            msgDiv.innerHTML = `<b>${author}:</b> ${text}`;
            chatBox.appendChild(msgDiv);
            chatBox.scrollTop = chatBox.scrollHeight;
        }
    </script>
</body>
</html>
