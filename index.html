<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cogitron Kids ðŸš€</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --primary: #FF6B6B;
            --secondary: #4ECDC4;
            --bg: #F7FFF7;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        .kids-card {
            background: white;
            padding: 30px;
            border-radius: 25px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            max-width: 400px;
            width: 100%;
            text-align: center;
            border: 4px solid var(--secondary);
        }
        input, select {
            width: 90%;
            padding: 12px;
            margin: 10px 0;
            border-radius: 15px;
            border: 2px solid #ddd;
            font-size: 16px;
        }
        button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
            margin: 5px;
        }
        button:hover { transform: scale(1.05); }
        #chat-section { display: none; width: 100%; max-width: 600px; }
        .bot-msg { background: #e8f4fd; padding: 15px; border-radius: 15px; margin: 10px 0; }
    </style>
</head>
<body>

    <div id="auth-section" class="kids-card">
        <h1>Coucou ! ðŸ‘‹</h1>
        <p>Demande Ã  tes parents de t'aider Ã  crÃ©er ton compte Cogitron.</p>
        <input type="email" id="email" placeholder="Email (celui des parents)">
        <input type="password" id="password" placeholder="Mot de passe secret">
        
        <label for="user-age">Ton Ã¢ge :</label>
        <select id="user-age">
            <option value="6">6 ans</option>
            <option value="8">8 ans</option>
            <option value="10">10 ans</option>
            <option value="12">12 ans</option>
        </select>

        <button onclick="handleAuth('signUp')">CrÃ©er mon compte</button>
        <button onclick="handleAuth('signIn')" style="background: var(--secondary)">Se connecter</button>
    </div>

    <div id="chat-section">
        <div class="kids-card">
            <h2>Discuter avec Cogitron ðŸ¤–</h2>
            <div id="chat-box"></div>
            <input type="text" id="user-input" placeholder="Pose-moi une question...">
            <button onclick="askAI()">Envoyer ðŸš€</button>
            <button onclick="signOut()" style="background:#666">Quitter</button>
        </div>
    </div>

    <script>
        // 1. CONFIGURATION (METS TES INFOS ICI)
        const SB_URL = "https://mrzevhvpoltsobxtkpxe.supabase.co";
        const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1yemV2aHZwb2x0c29ieHRrcHhlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA5MTY2MDksImV4cCI6MjA4NjQ5MjYwOX0.4NOt_j0aP02Nh-E_7mJy32hE8Q0ag0gA32PXgxNpSvU";
        const GROQ_KEY = "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";
        
        const supabase = supabase.createClient(SB_URL, SB_KEY);
        let userAge = 8;

        // 2. GESTION COMPTE (SUPABASE)
        async function handleAuth(type) {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            userAge = document.getElementById('user-age').value;

            const { data, error } = await supabase.auth[type]({
                email,
                password,
                options: { data: { age: userAge } }
            });

            if (error) alert("Oups : " + error.message);
            else {
                if (type === 'signUp') alert("Demande Ã  tes parents de cliquer sur le lien reÃ§u par email !");
                else showChat();
            }
        }

        function showChat() {
            document.getElementById('auth-section').style.display = 'none';
            document.getElementById('chat-section').style.display = 'block';
        }

        async function signOut() {
            await supabase.auth.signOut();
            location.reload();
        }

        // 3. LOGIQUE IA (GROQ)
        async function askAI() {
            const input = document.getElementById('user-input').value;
            const chatBox = document.getElementById('chat-box');
            
            chatBox.innerHTML += `<p><b>Toi:</b> ${input}</p>`;
            
            const response = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                method: "POST",
                headers: {
                    "Authorization": `Bearer ${GROQ_KEY}`,
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    "model": "llama-3.3-70b-versatile",
                    "messages": [
                        { "role": "system", "content": `Tu es un robot gentil pour un enfant de ${userAge} ans. Explique simplement, sans violence et sois encourageant.` },
                        { "role": "user", "content": input }
                    ]
                })
            });

            const result = await response.json();
            const reply = result.choices[0].message.content;
            chatBox.innerHTML += `<div class="bot-msg"><b>Cogitron:</b> ${reply}</div>`;
            document.getElementById('user-input').value = "";
        }
    </script>
</body>
</html>
