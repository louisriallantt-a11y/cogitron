<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Cogitron Omega</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <nav class="top-nav">
        <div class="logo">COGITRON Œ©</div>
        <div class="user-menu">
            {% if current_user.is_authenticated %}
                <span class="user-name" style="color: {{ current_user.color }}">{{ current_user.username }}</span>
                <div class="dropdown">
                    <button class="dropbtn">‚öôÔ∏è Menu</button>
                    <div class="dropdown-content">
                        {% if current_user.is_admin %}
                            <a href="#" onclick="openAdmin()">üî¥ Panel Admin</a>
                        {% endif %}
                        <a href="#">üé® Param√®tres</a>
                        <a href="/logout" style="color: #ff4d4d;">üö™ D√©connexion</a>
                    </div>
                </div>
            {% else %}
                <button onclick="document.getElementById('auth-modal').style.display='flex'">Se connecter</button>
            {% endif %}
        </div>
    </nav>

    <div class="chat-container">
        <div id="chat-box"></div>
        <div class="input-area">
            <input type="text" id="user-input" placeholder="Posez votre question...">
            <button onclick="sendMessage()">Envoyer</button>
        </div>
    </div>

    <div id="admin-modal" class="modal">
        <div class="modal-content admin-content">
            <span class="close" onclick="closeAdmin()">&times;</span>
            <h2>Panneau d'Administration</h2>
            <div id="admin-data">
                <h3>Utilisateurs</h3>
                <table id="users-table"></table>
                <h3>Bo√Æte √† id√©es</h3>
                <div id="ideas-list"></div>
            </div>
        </div>
    </div>

    <script>
        // Logique pour envoyer des messages
        async function sendMessage() {
            let input = document.getElementById('user-input');
            let box = document.getElementById('chat-box');
            if(!input.value) return;
            
            box.innerHTML += `<p><b>Moi:</b> ${input.value}</p>`;
            let res = await fetch('/chat', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({message: input.value})
            });
            let data = await res.json();
            box.innerHTML += `<p><b>IA:</b> ${data.reponse}</p>`;
            input.value = "";
        }

        // Logique Admin
        async function openAdmin() {
            document.getElementById('admin-modal').style.display = 'flex';
            let res = await fetch('/admin_stats');
            let data = await res.json();
            
            let table = document.getElementById('users-table');
            table.innerHTML = "<tr><th>Nom</th><th>Admin</th><th>Statut</th><th>Actions</th></tr>";
            data.users.forEach(u => {
                table.innerHTML += `
                    <tr>
                        <td>${u.username}</td>
                        <td>${u.is_admin ? '‚úÖ' : '‚ùå'}</td>
                        <td>${u.is_banned ? 'üö´ BAN' : 'üü¢ OK'}</td>
                        <td>
                            <button onclick="adminAction('ban', '${u.username}')">Bannir</button>
                            <button onclick="adminAction('unban', '${u.username}')">Gracier</button>
                            <button onclick="adminAction('promote', '${u.username}')">Admin</button>
                        </td>
                    </tr>`;
            });
        }

        async function adminAction(action, target) {
            await fetch('/admin_action', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({action, target})
            });
            openAdmin(); // Rafra√Æchir
        }

        function closeAdmin() { document.getElementById('admin-modal').style.display = 'none'; }
    </script>
</body>
</html>
